# upon updating run this
echo "$(whoami) ALL=(root) NOPASSWD: sha256:$(shasum -a 256 $(which yabai) | cut -d " " -f 1) $(which yabai) --load-sa" | sudo tee /private/etc/sudoers.d/yabai

yabai -m signal --add event=dock_did_restart action="sudo yabai --load-sa"
sudo yabai --load-sa

# scratchpad setup
yabai -m rule --add app="^TextEdit$" scratchpad=scratchpad grid=6:6:6:0:8:8

# sketchybar window title events
yabai -m signal --add event=window_focused action="sketchybar --trigger window_focus &> /dev/null"
yabai -m signal --add event=window_title_changed action="sketchybar --trigger title_change &> /dev/null"

# rule for setting up unmanaged apps
yabai_rule() {
  yabai -m rule --add "$@"
  yabai -m rule --apply "$@"
}

GRID_CENTER="6:6:1:1:4:4"

yabai -m config default layout bsp

yabai -m config window_origin_display

yabai -m config window_insertion_point focused

yabai -m config window_zoom_persist true

# Disabled because browser popups will disappear if its enabled
yabai -m config window_topmost off 

yabai -m config split_type auto

yabai -m config auto_balance off

yabai -m config split_ratio 0.5

yabai -m config window_animation_duration 0.1

yabai -m config window_animation_easing easeOutElastic

# New window spawns to the right if vertical split, or bottom if horizontal split
yabai -m config window_placement second_child

# padding of 1 required for borders
yabai -m config top_padding 1
yabai -m config bottom_padding 1
yabai -m config left_padding 1
yabai -m config right_padding 1

#  window gaps
yabai -m config window_gap 5

# pin apps to workspaces
yabai_rule app="^Helium$" space=1
yabai_rule app="^Zen$" space=2
yabai_rule app="^Bloom$" space=3
yabai_rule app="^WezTerm$" space=4
yabai_rule app="^Calendar$" space=5
yabai_rule app="^Notes$" space=5
yabai_rule app="^Mail$" space=5
yabai_rule app="^ChatGPT$" space=6
yabai_rule app="^Chromatix$" space=7

# Float apps
FLOAT_APPS=(
  "^System Settings$"
  "^Calculator$"
  "^balenaEtcher$"
  "^Raspberry Pi Imager$"
  "^Blackmagic Disk Speed Test$"
  "^coconutBattery$"
  "^Raycast$"
  "^iPhone Mirroring$"
  "^Stickies$"
  "^VMware Fusion$"
  "^Leader Key$"
  "^Mouseless$"
  "^Steam$"
  "^QuickRecorder$"
  "^Ice$"
  "^Shottr$"
  "^IINA$"
  "^TheBoringNotch$"
  "^Numi$"
  "^Mousecape$"
  "^Finder$"
  "^MediaMate$"
  "^2048 Game$"
  "^BlueStacks$"
  "^BresinkSoftwareUpdater$"
  "^Clop$"
  "^Speediness$"
  "^BetterDisplay$"
  "^Find Any File$"
  "^ConnectMeNow4$"
  "^Cyberduck$"
  "^Mountain Duck$"
  "^KeyClu$"
  "^KeyCastr$"
  "^reAMP$"
  "^Menuwhere$"
  "^OnyX$"
  "^Shortcat$"
  "^PopClip$"
  "^PoolsuiteFM$"
  "^MountMate$"
  "^App Buddy$"
  "^Default Folder X$"
  "^Dato$"
  "^OmniDiskSweeper$"
  "^Network Utility$"
  "^ImageOptim$"
  "^GrandPerspective$"
  "^Keka$"
  "^Creator$"
  "^Whisky$"
  "^Battery Toolkit$"
  "^BetterDiscord$"
  "^Aliento$"
  "^Dropover$"
  "^Flux$"
  "^SilentKnight$"
  "^Tailscale$"
  "^Little Snitch$"
  "^TimeMachineEditor$"
  "^TinkerTool$"
  "^Archive Utility$"
  "^Photo Booth$"
  "^Wallper$"
  "^Steam$"
  "^GOG Galaxy$"
  "^Epic Games Launcher$"
  "^Battle.net$"
  "^Folder Preview$"
  "^Plexamp$"
  "^MacWhisper$"
  "^Cotypist$"
)

for app in "${FLOAT_APPS[@]}"; do
  yabai_rule \
    app="$app" \
    manage=off \
    grid="$GRID_CENTER"
done

# window opacity
yabai -m config window_shadow off
yabai -m config window_opacity on
yabai -m config window_opacity_duration 0.1
yabai -m config active_window_opacity 1.0
yabai -m config normal_window_opacity 0.75
yabai -m config menubar_opacity 0.0

# center mouse on focused window
yabai -m config mouse_follows_focus on

# autoraise hovered windows hovered
yabai -m config focus_follows_mouse autoraise

# modifier for clicking and dragging with mouse
yabai -m config mouse_modifier alt

# set modifier + left-click drag to resize window	
yabai -m config mouse_action1 resize

# set modifier + right-click drag to move window
yabai -m config mouse_action2 move

# swap windows on mouse drop
yabai -m mouse_drop_action swap

# white feedback color
yabai -m config event_feedback on
yabai -m config insert_feedback_color 0xFFFFFFFF

yabai -m config debug_output off

# bootstrap jankyborders with yabai service
borders hidpi=on width=1.0 active_color="glow(0xFFFFFFFF)" inactive_color="0x0xff1e1e1e" style=round ax_focus=on order=above blacklist="Stats,Dropover,iPhone Mirroring,Passwords,SoundSource,Stickies" &

# auto updating HEAD from brew
YABAI_CERT=yabai-cert sh -c "$(curl -fsSL "https://git.io/update-yabai")" &
